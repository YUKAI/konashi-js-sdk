/*! konashi-bridge.js v1.0.0 2013-07-01 http://konashi.ux-xu.com/kjs */
!function(){var a={KONASHI_URL_SCHEME:"konashijs",HIGH:1,LOW:0,OUTPUT:1,INPUT:0,PULLUP:1,NO_PULLS:0,ENABLE:1,DISABLE:0,TRUE:1,FALSE:0,KONASHI_SUCCESS:0,KONASHI_FAILURE:-1,PIO0:0,PIO1:1,PIO2:2,PIO3:3,PIO4:4,PIO5:5,PIO6:6,PIO7:7,S1:0,LED2:1,LED3:2,LED4:3,LED5:4,AIO0:0,AIO1:1,AIO2:2,I2C_SDA:6,I2C_SCL:7,KONASHI_PWM_DISABLE:0,KONASHI_PWM_ENABLE:1,KONASHI_PWM_ENABLE_LED_MODE:2,KONASHI_PWM_LED_PERIOD:1e4,KONASHI_ANALOG_REFERENCE:1300,KONASHI_UART_RATE_2K4:10,KONASHI_UART_RATE_9K6:40,KONASHI_I2C_DATA_MAX_LENGTH:18,KONASHI_I2C_DISABLE:0,KONASHI_I2C_ENABLE:1,KONASHI_I2C_ENABLE_100K:1,KONASHI_I2C_ENABLE_400K:2,KONASHI_I2C_STOP_CONDITION:0,KONASHI_I2C_START_CONDITION:1,KONASHI_I2C_RESTART_CONDITION:2,KONASHI_UART_DATA_MAX_LENGTH:19,KONASHI_UART_DISABLE:0,KONASHI_UART_ENABLE:1,KONASHI_EVENT_CENTRAL_MANAGER_POWERED_ON:"centralManagerPoweredOn",KONASHI_EVENT_PERIPHERAL_NOT_FOUND:"peripheralNotFound",KONASHI_EVENT_CONNECTED:"connected",KONASHI_EVENT_DISCONNECTED:"disconnected",KONASHI_EVENT_READY:"ready",KONASHI_EVENT_UPDATE_PIO_INPUT:"updatePioInput",KONASHI_EVENT_UPDATE_ANALOG_VALUE:"updateAnalogValue",KONASHI_EVENT_UPDATE_ANALOG_VALUE_AIO0:"updateAnalogValueAio0",KONASHI_EVENT_UPDATE_ANALOG_VALUE_AIO1:"updateAnalogValueAio1",KONASHI_EVENT_UPDATE_ANALOG_VALUE_AIO2:"updateAnalogValueAio2",KONASHI_EVENT_I2C_READ_COMPLETE:"completeReadI2c",KONASHI_EVENT_UART_RX_COMPLETE:"completeUartRx",KONASHI_EVENT_UPDATE_BATTERY_LEVEL:"updateBatteryLevel",KONASHI_EVENT_UPDATE_SIGNAL_STRENGTH:"updateSignalStrength",handlers:{},callbacks:{},messages:[],messageCount:0,on:function(a,b){this.handlers[a]||(this.handlers[a]=[]),this.handlers[a].push(b)},off:function(a,b){this.handlers[a]&&(b&&"function"==typeof b&&this.handlers[a][b]?delete this.handlers[a][b]:delete this.handlers[a])},addObserver:function(a,b){this.on(a,b)},removeObserver:function(a,b){this.off(a,b)},trigger:function(a,b,c){var d=this.messageCount++,e=b||{},f=c||function(){};this.callbacks[d]=function(a){f(a)},this.messages.push({eventName:a,messageId:d,data:e}),1==this.messages.length&&this.triggerToNative()},triggerToNative:function(){var a=this.messages[0].eventName,b=this.messages[0].messageId,c=this.messages[0].data,d=document.createElement("iframe");d.setAttribute("style","display:none"),d.setAttribute("height","0px"),d.setAttribute("width","0px"),d.setAttribute("frameborder","0"),d.setAttribute("src",this.KONASHI_URL_SCHEME+"://"+a+"/"+b+"?"+encodeURIComponent(JSON.stringify(c))),document.documentElement.appendChild(d),setTimeout(function(){d.parentNode.removeChild(d),d=void 0},10),this.messages.shift()},centralManagerPoweredOn:function(a){a&&"function"==typeof a&&this.on(k.KONASHI_EVENT_CENTRAL_MANAGER_POWERED_ON,function(){a()})},peripheralNotFound:function(a){a&&"function"==typeof a&&this.on(k.KONASHI_EVENT_PERIPHERAL_NOT_FOUND,function(){a()})},connected:function(a){a&&"function"==typeof a&&this.on(k.KONASHI_EVENT_CONNECTED,function(){a()})},disconnected:function(a){a&&"function"==typeof a&&this.on(k.KONASHI_EVENT_DISCONNECTED,function(){a()})},ready:function(a){a&&"function"==typeof a&&this.on(k.KONASHI_EVENT_READY,function(){a()})},updatePioInput:function(a){a&&"function"==typeof a&&this.on(k.KONASHI_EVENT_UPDATE_PIO_INPUT,function(b){a(b.value)})},updateAnalogValue:function(a){a&&"function"==typeof a&&this.on(k.KONASHI_EVENT_UPDATE_ANALOG_VALUE,function(){a()})},updateAnalogValueAio0:function(a){a&&"function"==typeof a&&this.on(k.KONASHI_EVENT_UPDATE_ANALOG_VALUE_AIO0,function(b){a(b.value)})},updateAnalogValueAio1:function(a){a&&"function"==typeof a&&this.on(k.KONASHI_EVENT_UPDATE_ANALOG_VALUE_AIO1,function(b){a(b.value)})},updateAnalogValueAio2:function(a){a&&"function"==typeof a&&this.on(k.KONASHI_EVENT_UPDATE_ANALOG_VALUE_AIO2,function(b){a(b.value)})},completeReadI2c:function(a){a&&"function"==typeof a&&this.on(k.KONASHI_EVENT_I2C_READ_COMPLETE,function(){a()})},completeUartRx:function(a){a&&"function"==typeof a&&this.on(k.KONASHI_EVENT_UART_RX_COMPLETE,function(b){a(b.value)})},updateBatteryLevel:function(a){a&&"function"==typeof a&&this.on(k.KONASHI_EVENT_UPDATE_BATTERY_LEVEL,function(b){a(b.value)})},updateSignalStrength:function(a){a&&"function"==typeof a&&this.on(k.KONASHI_EVENT_UPDATE_SIGNAL_STRENGTH,function(b){a(b.value)})},find:function(){k.trigger("find")},findWithName:function(a){k.trigger("findWithName",{name:a})},disconnect:function(){k.trigger("disconnect")},isConnected:function(a){a&&"function"==typeof a&&k.trigger("isConnected",{},function(b){a(b.isConnected)})},peripheralName:function(a){a&&"function"==typeof a&&k.trigger("peripheralName",{},function(b){a(b.peripheralName)})},pinMode:function(a,b){k.trigger("pinMode",{pin:a,mode:b})},pinModeAll:function(a){k.trigger("pinModeAll",{mode:a})},pinPullup:function(a,b){k.trigger("pinPullup",{pin:a,mode:b})},pinPullupAll:function(a){k.trigger("pinPullupAll",{mode:a})},digitalRead:function(a,b){b&&"function"==typeof b&&k.trigger("digitalRead",{pin:a},function(a){b(a.input)})},digitalReadAll:function(a){a&&"function"==typeof a&&k.trigger("digitalReadAll",{},function(b){a(b.input)})},digitalWrite:function(a,b){k.trigger("digitalWrite",{pin:a,value:b})},digitalWriteAll:function(a){k.trigger("digitalWriteAll",{value:a})},analogReference:function(a){a&&"function"==typeof a&&k.trigger("analogReference",{},function(b){a(b.value)})},analogReadRequest:function(a){k.trigger("analogReadRequest",{pin:a})},analogRead:function(a,b){b&&"function"==typeof b&&k.trigger("analogRead",{pin:a},function(a){b(a.value)})},analogWrite:function(a,b){k.trigger("analogWrite",{pin:a,millivolt:b})},pwmMode:function(a,b){k.trigger("pwmMode",{pin:a,mode:b})},pwmPeriod:function(a,b){k.trigger("pwmPeriod",{pin:a,period:b})},pwmDuty:function(a,b){k.trigger("pwmDuty",{pin:a,duty:b})},pwmLedDrive:function(a,b){k.trigger("pwmLedDrive",{pin:a,dutyRatio:b})},uartMode:function(a){k.trigger("uartMode",{mode:a})},uartBaudrate:function(a){k.trigger("uartBaudrate",{baudrate:a})},uartWrite:function(a){k.trigger("uartWrite",{data:a})},i2cMode:function(a){k.trigger("i2cMode",{mode:a})},i2cStartCondition:function(){k.trigger("i2cStartCondition",{})},i2cRestartCondition:function(){k.trigger("i2cRestartCondition",{})},i2cStopCondition:function(){k.trigger("i2cStopCondition",{})},i2cWrite:function(a,b,c){k.trigger("i2cWrite",{length:a,data:b,address:c})},i2cReadRequest:function(a,b){k.trigger("i2cReadRequest",{length:a,address:b})},i2cRead:function(a,b){b&&"function"==typeof b&&k.trigger("i2cRead",{length:a},function(a){b(a.value)})},reset:function(){k.trigger("reset",{})},batteryLevelReadRequest:function(){k.trigger("batteryLevelReadRequest",{})},batteryLevelRead:function(a){a&&"function"==typeof a&&k.trigger("batteryLevelRead",{},function(b){a(b.value)})},signalStrengthReadRequest:function(){k.trigger("signalStrengthReadRequest",{})},signalStrengthRead:function(a){a&&"function"==typeof a&&k.trigger("signalStrengthRead",{},function(b){a(b.value)})},noConflict:function(){return window.k=b,this},log:function(a){var b=document.getElementById("konashi-debug-console");if(b){var c=document.createElement("p");c.innerHTML=a,b.firstChild?b.insertBefore(c,b.firstChild):b.appendChild(c)}},showDebugLog:function(){var a=document.createElement("div");a.setAttribute("style","position:fixed;left:0px;top:0px;z-index:100000;width:200px;height:100px;background-color:rgba(0,0,0,0.6);color:#FFF;font-size:11px;overflow:hidden;"),a.setAttribute("id","konashi-debug-console"),document.documentElement.appendChild(a)},hideDebugLog:function(){var a=document.getElementById("konashi-debug-console");a.parentNode.removeChild(a)},triggerFromNative:function(a,b){this.log("triggerFromNative eventname: "+a+", data: "+JSON.stringify(b));for(var c=this.handlers[a]||[],d=0;d<c.length;d++){var e=c[d];e&&"function"==typeof e&&setTimeout(function(){e(b)},0)}},triggerCallback:function(a,b){var c=this;this.log("triggerCallback id: "+a+", data: "+JSON.stringify(b)),setTimeout(function(){try{c.callbacks[Number(a)](b),c.callbacks[Number(a)]=void 0,delete c.callbacks[Number(a)]}catch(d){}c.messages.length>0&&c.triggerToNative()},0)}},b=window.k;window.k=a}();